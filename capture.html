<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Capture Photo / Upload Video</title>
    <style>
        video, canvas { max-width: 100%; height: auto; }
        button { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Capture Photo or Upload Video</h1>
    
    <!-- Video preview -->
    <video id="camera" autoplay playsinline></video>
    <br>
    <button id="captureBtn">Capture Photo</button>

    <!-- Hidden canvas for photo processing -->
    <canvas id="photoCanvas" style="display:none;"></canvas>

    <form id="uploadForm" enctype="multipart/form-data" method="POST" action="save_upload.php">
        <input type="file" name="video" accept="video/*">
        <button type="submit">Upload Video</button>
    </form>

    <script>
        const video = document.getElementById('camera');
        const canvas = document.getElementById('photoCanvas');
        const captureBtn = document.getElementById('captureBtn');

        // Access back camera by default
        navigator.mediaDevices.getUserMedia({
            video: { facingMode: { exact: "environment" } }
        })
        .then(stream => {
            video.srcObject = stream;
        })
        .catch(err => {
            console.error("Error accessing camera:", err);
        });

        captureBtn.addEventListener('click', () => {
            // Match canvas size to video resolution
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('photo', blob, 'temp.jpg');

                fetch('save_upload.php', {
                    method: 'POST',
                    body: formData
                })
                .then(res => res.text())
                .then(data => {
                    alert(data);
                });
            }, 'image/jpeg', 0.95);
        });
    </script>
</body>
</html>
