<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Capture & Upload</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center min-h-screen p-6">

  <h1 class="text-2xl font-bold mb-4">Capture Photo & Upload Video</h1>

  <!-- Webcam -->
  <div class="mb-4">
    <video id="webcam" autoplay playsinline class="rounded-lg shadow-lg"></video>
  </div>

  <!-- Capture Button -->
  <button id="captureBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
    üì∏ Capture Photo
  </button>

  <!-- Preview -->
  <div class="mt-4">
    <canvas id="photoCanvas" class="hidden"></canvas>
    <img id="photoPreview" class="mt-2 rounded-lg shadow-lg hidden" />
  </div>

  <!-- Upload Video -->
  <form id="uploadForm" class="mt-6 flex flex-col gap-4" enctype="multipart/form-data">
    <input type="file" name="video" id="videoInput" accept="video/*"
      class="text-gray-300 bg-gray-800 border border-gray-700 rounded p-2" required>
    <input type="hidden" name="photoData" id="photoData">
    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
      ‚¨ÜÔ∏è Upload to Assets
    </button>
  </form>

  <div id="status" class="mt-4 text-sm text-gray-400"></div>

  <script>
    const webcam = document.getElementById("webcam");
    const photoCanvas = document.getElementById("photoCanvas");
    const photoPreview = document.getElementById("photoPreview");
    const photoData = document.getElementById("photoData");
    const captureBtn = document.getElementById("captureBtn");

    // Example reference scan photo resolution (change to your actual)
    const scanWidth = 640;
    const scanHeight = 480;

    navigator.mediaDevices.getUserMedia({ video: { width: scanWidth, height: scanHeight } })
      .then(stream => webcam.srcObject = stream)
      .catch(err => console.error("Camera error:", err));

    captureBtn.addEventListener("click", () => {
      photoCanvas.width = scanWidth;
      photoCanvas.height = scanHeight;
      const ctx = photoCanvas.getContext("2d");
      ctx.drawImage(webcam, 0, 0, scanWidth, scanHeight);

      const dataURL = photoCanvas.toDataURL("image/png");
      photoData.value = dataURL;
      photoPreview.src = dataURL;
      photoPreview.classList.remove("hidden");
    });

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);

      const res = await fetch("save_media.php", {
        method: "POST",
        body: formData
      });
      const result = await res.text();
      document.getElementById("status").innerText = result;
    });
  </script>
</body>
</html>
